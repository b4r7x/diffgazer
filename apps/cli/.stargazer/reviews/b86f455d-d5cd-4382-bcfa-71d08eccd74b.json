{
  "metadata": {
    "id": "b86f455d-d5cd-4382-bcfa-71d08eccd74b",
    "projectPath": "/Users/voitz/Projects/stargazer/apps/cli",
    "createdAt": "2026-01-24T09:34:15.726Z",
    "staged": false,
    "branch": "feature/review-bounding",
    "overallScore": null,
    "issueCount": 0,
    "criticalCount": 0,
    "warningCount": 0
  },
  "result": {
    "summary": "```json\n{\n  \"summary\": \"The diff represents a significant refactor and feature expansion. Key changes include migrating from a custom Gemini client to the Vercel AI SDK (supporting OpenAI, Anthropic, and Google), expanding the CLI's 'review' command capabilities (file filtering, history, resuming), and implementing security hardening against prompt injection (CVE-2025-53773). The architecture is improved by moving shared utilities to a core package and modularizing API calls.\",\n  \"issues\": [\n    {\n      \"severity\": \"suggestion\",\n      \"category\": \"security\",\n      \"file\": \"apps/server/src/services/review-orchestrator.ts\",\n      \"line\": 65,\n      \"title\": \"Potential for escaped characters in AI output\",\n      \"description\": \"User-provided file paths are now XML-escaped before being inserted into the prompt. While this prevents prompt injection, if the AI model echoes these paths back in its JSON response (e.g., the 'file' field in an issue), it may return the escaped version (e.g., 'test&quot;file.ts' instead of 'test\\\"file.ts'), which could break file matching in the UI.\",\n      \"suggestion\": \"Ensure the parsing logic or the system prompt instructs the model to return the original unescaped file paths, or perform an unescape operation on the AI's JSON response.\"\n    },\n    {\n      \"severity\": \"nitpick\",\n      \"category\": \"performance\",\n      \"file\": \"apps/server/src/services/review.ts\",\n      \"line\": 11,\n      \"title\": \"Significant increase in max diff size\",\n      \"description\": \"MAX_DIFF_SIZE_BYTES was increased from 100KB to 512KB. While this allows for larger reviews, it significantly increases potential token usage and costs, especially with more expensive models like GPT-4o or Claude Opus.\",\n      \"suggestion\": \"Consider making this limit configurable or implementing a token-based warning/cutoff to manage costs.\"\n    },\n    {\n      \"severity\": \"best-practice\",\n      \"category\": \"logic\",\n      \"file\": \"apps/server/src/api/routes/chat.ts\",\n      \"line\": 36,\n      \"title\": \"Swallowed SSE errors\",\n      \"description\": \"In the SSE stream, errors are caught and an attempt is made to write an SSE error. If the second attempt fails (e.g., the stream is already fully closed), the error is swallowed with a comment. While common in SSE, it can make debugging server-side disconnects difficult.\",\n      \"suggestion\": \"Add at least a server-side log in the final catch block to record that an error occurred even if it couldn't be transmitted to the client.\"\n    },\n    {\n      \"severity\": \"nitpick\",\n      \"category\": \"style\",\n      \"file\": \"apps/cli/src/commands/review.ts\",\n      \"line\": 23,\n      \"title\": \"Implicit type casting in parseFilesOption\",\n      \"description\": \"The function splits by comma and then filters Boolean. This works well for 'file1, file2' but might be cleaner using a more explicit regex if paths contain unusual characters.\",\n      \"suggestion\": \"The current implementation is functional for most CLI use cases, but ensure it handles paths with spaces correctly if they are not quoted by the shell.\"\n    }\n  ],\n  \"overallScore\": 9\n}\n```",
    "issues": [],
    "overallScore": null
  },
  "gitContext": {
    "branch": "feature/review-bounding",
    "fileCount": 50
  }
}
